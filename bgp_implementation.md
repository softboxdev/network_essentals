
## 1. –ß—Ç–æ —Ç–∞–∫–æ–µ iBGP?

**iBGP (Internal BGP)** - —ç—Ç–æ –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è –æ–±–º–µ–Ω–∞ –º–∞—Ä—à—Ä—É—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π **–≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã (AS)**.

## 2. –û—Å–Ω–æ–≤–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ iBGP

```mermaid
flowchart TD
    A[–ê–≤—Ç–æ–Ω–æ–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ AS 65001] --> B[–¢–æ–ø–æ–ª–æ–≥–∏—è –ø–æ–ª–Ω–æ–π —è—á–µ–∏—Å—Ç–æ–π —Å–µ—Ç–∏<br>Full Mesh]
    
    B --> C[–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä A]
    B --> D[–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä B]
    B --> E[–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä C]
    B --> F[–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä D]
    
    C --> G[iBGP —Å–µ—Å—Å–∏–∏<br>—Å–æ –≤—Å–µ–º–∏ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞–º–∏]
    D --> G
    E --> G
    F --> G
    
    H[–í–Ω–µ—à–Ω—è—è —Å–µ—Ç—å] --> I[eBGP —Å–µ—Å—Å–∏–∏<br>—Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑<br>–≥—Ä–∞–Ω–∏—á–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä—ã]
    I --> C
    I --> F
```

## 3. –ü—Ä–æ—Ü–µ—Å—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è iBGP —Å–µ—Å—Å–∏–∏

```mermaid
sequenceDiagram
    participant A as –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä A
    participant B as –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä B
    
    Note over A,B: –≠—Ç–∞–ø 1: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    A->>A: router bgp 65001<br>neighbor B_IP remote-as 65001
    B->>B: router bgp 65001<br>neighbor A_IP remote-as 65001
    
    Note over A,B: –≠—Ç–∞–ø 2: –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ TCP —Å–µ—Å—Å–∏–∏
    A->>B: TCP SYN (–ø–æ—Ä—Ç 179)
    B->>A: TCP SYN-ACK
    A->>B: TCP ACK
    Note over A,B: TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ
    
    Note over A,B: –≠—Ç–∞–ø 3: –û–±–º–µ–Ω BGP —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏
    A->>B: OPEN message
    B->>A: OPEN message
    Note over A,B: –ü–∞—Ä–∞–º–µ—Ç—Ä—ã —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã
    
    A->>B: KEEPALIVE
    B->>A: KEEPALIVE
    Note over A,B: iBGP —Å–µ—Å—Å–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
    
    A->>B: UPDATE (–º–∞—Ä—à—Ä—É—Ç—ã)
    B->>A: UPDATE (–º–∞—Ä—à—Ä—É—Ç—ã)
```

## 4. –ü—Ä–∞–≤–∏–ª–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ iBGP

```mermaid
flowchart TD
    A[–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä –ø–æ–ª—É—á–∞–µ—Ç<br>–≤–Ω–µ—à–Ω–∏–π –º–∞—Ä—à—Ä—É—Ç —á–µ—Ä–µ–∑ eBGP] --> B{–ü—Ä–∞–≤–∏–ª–æ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏}
    
    B --> C[–í–∫–ª—é—á–µ–Ω–æ sync]
    C --> D{–ú–∞—Ä—à—Ä—É—Ç –µ—Å—Ç—å –≤ IGP?}
    D -->|–î–∞| E[–†–∞–∑—Ä–µ—à–∏—Ç—å<br>–∞–¥–≤–µ—Ä—Ç–∞–π–∑ –≤ iBGP]
    D -->|–ù–µ—Ç| F[–ó–∞–ø—Ä–µ—Ç–∏—Ç—å<br>–∞–¥–≤–µ—Ä—Ç–∞–π–∑ –≤ iBGP]
    
    B --> G[–í—ã–∫–ª—é—á–µ–Ω–æ sync<br>—Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–µ—Ç–∏]
    G --> H[–í—Å–µ–≥–¥–∞ —Ä–∞–∑—Ä–µ—à–∏—Ç—å<br>–∞–¥–≤–µ—Ä—Ç–∞–π–∑ –≤ iBGP]
```

## 5. –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞ —á–µ—Ä–µ–∑ iBGP

```mermaid
flowchart TD
    A[–ì—Ä–∞–Ω–∏—á–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä] --> B[–ü–æ–ª—É—á–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç –æ—Ç eBGP —Å–æ—Å–µ–¥–∞]
    B --> C[–î–æ–±–∞–≤–ª—è–µ—Ç —Å–≤–æ–π AS_PATH<br>–∏ –¥—Ä—É–≥–∏–µ –∞—Ç—Ä–∏–±—É—Ç—ã]
    C --> D[–û–±–Ω–æ–≤–ª—è–µ—Ç –ª–æ–∫–∞–ª—å–Ω—É—é RIB]
    
    D --> E[–†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –≤ iBGP]
    E --> F{–ü—Ä–∞–≤–∏–ª–æ iBGP: <br>–ù–µ –∞–¥–≤–µ—Ä—Ç–∞–π–∑–∏—Ç—å<br>iBGP-learned routes<br>–¥—Ä—É–≥–∏–º iBGP —Å–æ—Å–µ–¥—è–º}
    
    F --> G[–†–µ—à–µ–Ω–∏–µ: Full Mesh<br>–∏–ª–∏ Route Reflector]
    
    G --> H[–í–∞—Ä–∏–∞–Ω—Ç 1: Full Mesh]
    H --> I[–ê–¥–≤–µ—Ä—Ç–∞–π–∑ –Ω–∞–ø—Ä—è–º—É—é<br>–≤—Å–µ–º iBGP —Å–æ—Å–µ–¥—è–º]
    
    G --> J[–í–∞—Ä–∏–∞–Ω—Ç 2: Route Reflector]
    J --> K[–ê–¥–≤–µ—Ä—Ç–∞–π–∑ —Ç–æ–ª—å–∫–æ<br>Route Reflector'—É]
    K --> L[Route Reflector<br>—Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç –≤—Å–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º]
```

## 6. –°—Ä–∞–≤–Ω–µ–Ω–∏–µ iBGP –∏ eBGP

```mermaid
flowchart LR
    subgraph AS1 [–ê–≤—Ç–æ–Ω–æ–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ 65001]
        A[–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä A]
        B[–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä B]
        C[–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä C]
    end
    
    subgraph AS2 [–ê–≤—Ç–æ–Ω–æ–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ 65002]
        D[–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä D]
        E[–ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä E]
    end
    
    A <-->|iBGP<br>Same AS| B
    B <-->|iBGP<br>Same AS| C
    A <-->|iBGP<br>Same AS| C
    
    A <-->|eBGP<br>Different AS| D
    C <-->|eBGP<br>Different AS| E
```

## 7. –ê—Ç—Ä–∏–±—É—Ç—ã BGP –≤ iBGP

```mermaid
flowchart TD
    A[BGP UPDATE Message] --> B[–ê—Ç—Ä–∏–±—É—Ç—ã –ø—É—Ç–∏]
    
    B --> C[AS_PATH]
    C --> D[iBGP: –ù–µ –¥–æ–±–∞–≤–ª—è–µ—Ç AS<br>eBGP: –î–æ–±–∞–≤–ª—è–µ—Ç AS]
    
    B --> E[NEXT_HOP]
    E --> F[iBGP: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª<br>eBGP: –ú–µ–Ω—è–µ—Ç –Ω–∞ —Å–≤–æ–π IP]
    
    B --> G[LOCAL_PREF]
    G --> H[–¢–æ–ª—å–∫–æ –≤ iBGP<br>–í—ã—Å–æ–∫–∏–π = –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω—ã–π]
    
    B --> I[MED]
    I --> J[–ê–¥–≤–µ—Ä—Ç–∞–π–∑–∏—Ç—Å—è –≤ iBGP<br>–°—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç—Å—è –º–µ–∂–¥—É —Ä–∞–∑–Ω—ã–º–∏ AS]
```

## 8. –ü—Ä–æ—Ü–µ—Å—Å –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π –≤ iBGP

```mermaid
flowchart TD
    A[–ü–æ–ª—É—á–µ–Ω BGP –º–∞—Ä—à—Ä—É—Ç] --> B[–í–∞–ª–∏–¥–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–∞]
    B --> C{–í–∞–ª–∏–¥–Ω—ã–π?}
    C -->|–ù–µ—Ç| D[–û—Ç–∫–ª–æ–Ω–∏—Ç—å]
    
    C -->|–î–∞| E[BGP Decision Process]
    
    E --> F[1. Highest Weight<br>Cisco specific]
    E --> G[2. Highest LOCAL_PREF]
    E --> H[3. Local originated]
    E --> I[4. Shortest AS_PATH]
    E --> J[5. Lowest Origin type]
    E --> K[6. Lowest MED]
    E --> L[7. eBGP > iBGP]
    E --> M[8. Lowest IGP metric]
    E --> N[9. Oldest path]
    E --> O[10. Router ID]
    E --> P[11. Neighbor IP]
    
    Q[–í—ã–±—Ä–∞–Ω –ª—É—á—à–∏–π –ø—É—Ç—å] --> R[–î–æ–±–∞–≤–∏—Ç—å –≤ RIB]
    R --> S[–ê–¥–≤–µ—Ä—Ç–∞–π–∑–æ–≤–∞—Ç—å —Å–æ—Å–µ–¥—è–º]
```

## 9. –ü—Ä–∏–º–µ—Ä —Ä–∞–±–æ—Ç—ã Route Reflector

```mermaid
flowchart TD
    A[Route Reflector] --> B[–ö–ª–∏–µ–Ω—Ç 1]
    A --> C[–ö–ª–∏–µ–Ω—Ç 2]
    A --> D[–ö–ª–∏–µ–Ω—Ç 3]
    
    E[–ù–µ–∫–ª–∏–µ–Ω—Ç—Å–∫–∏–π —Å–æ—Å–µ–¥] --> A
    A --> E
    
    B --> F[–ü–æ–ª—É—á–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç –æ—Ç eBGP]
    F --> B[–ê–¥–≤–µ—Ä—Ç–∞–π–∑–∏—Ç Route Reflector]
    B --> A
    
    A --> G[–†–µ—Ñ–ª–µ–∫—Ç–∏—Ä—É–µ—Ç –≤—Å–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º]
    A --> C
    A --> D
    
    A --> H[–†–µ—Ñ–ª–µ–∫—Ç–∏—Ä—É–µ—Ç –Ω–µ–∫–ª–∏–µ–Ω—Ç–∞–º<br>–ø–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –ø—Ä–∞–≤–∏–ª–∞–º]
    A --> E
```

## 10. –ü–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ iBGP –º–∞—Ä—à—Ä—É—Ç–∞

```mermaid
flowchart TD
    A[–ù–∞—á–∞–ª–æ] --> B[–ü–æ–ª—É—á–µ–Ω BGP UPDATE]
    B --> C[–ü–∞—Ä—Å–∏–Ω–≥ –∞—Ç—Ä–∏–±—É—Ç–æ–≤]
    
    C --> D{–¢–∏–ø —Å–æ—Å–µ–¥–∞?}
    D -->|eBGP| E[–û–±—Ä–∞–±–æ—Ç–∫–∞ eBGP]
    D -->|iBGP| F[–û–±—Ä–∞–±–æ—Ç–∫–∞ iBGP]
    
    F --> G[–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª–∞<br>—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏]
    G --> H{–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è<br>—Ç—Ä–µ–±—É–µ—Ç—Å—è?}
    
    H -->|–î–∞| I{–ú–∞—Ä—à—Ä—É—Ç –≤ IGP?}
    I -->|–ù–µ—Ç| J[–û—Ç–∫–ª–æ–Ω–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç]
    I -->|–î–∞| K[–ü—Ä–∏–Ω—è—Ç—å –º–∞—Ä—à—Ä—É—Ç]
    
    H -->|–ù–µ—Ç| K
    
    K --> L[BGP Decision Process]
    L --> M[–í—ã–±–æ—Ä –ª—É—á—à–µ–≥–æ –ø—É—Ç–∏]
    M --> N[–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ RIB]
    N --> O[–ê–¥–≤–µ—Ä—Ç–∞–π–∑ —Å–æ—Å–µ–¥—è–º]
    
    O --> P{iBGP learned?}
    P -->|–î–∞| Q[–ê–¥–≤–µ—Ä—Ç–∞–π–∑ —Ç–æ–ª—å–∫–æ<br>eBGP —Å–æ—Å–µ–¥—è–º]
    P -->|–ù–µ—Ç| R[–ê–¥–≤–µ—Ä—Ç–∞–π–∑ –≤—Å–µ–º<br>—Å–æ—Å–µ–¥—è–º]
```

## 11. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
! –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä A –≤ AS 65001
router bgp 65001
 bgp router-id 1.1.1.1
 bgp log-neighbor-changes
 ! iBGP —Å–æ—Å–µ–¥–∏
 neighbor 192.168.1.2 remote-as 65001
 neighbor 192.168.1.3 remote-as 65001
 ! eBGP —Å–æ—Å–µ–¥
 neighbor 10.1.1.2 remote-as 65002
 ! –û—Ç–∫–ª—é—á–µ–Ω–∏–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
 no synchronization
 ! –ü–æ–ª–∏—Ç–∏–∫–∞ —Å–µ—Ç–∏
 network 192.168.1.0 mask 255.255.255.0
```

## –ö–ª—é—á–µ–≤—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ iBGP:

1. **–¢–æ—Ç –∂–µ AS –Ω–æ–º–µ—Ä** —É –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
2. **Full Mesh —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ** (–±–µ–∑ Route Reflector)
3. **–ù–µ –∏–∑–º–µ–Ω—è–µ—Ç AS_PATH** –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
4. **–°–æ—Ö—Ä–∞–Ω—è–µ—Ç NEXT_HOP** –æ—Ç eBGP —Å–æ—Å–µ–¥–∞
5. **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç LOCAL_PREF** –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç—Ä–∞—Ñ–∏–∫–æ–º –≤–Ω—É—Ç—Ä–∏ AS

iBGP –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–π –º–∞—Ä—à—Ä—É—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã, —Ä–∞–±–æ—Ç–∞—è –ø–æ–≤–µ—Ä—Ö IGP (OSPF, EIGRP), –∫–æ—Ç–æ—Ä—ã–π –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Å–≤—è–∑–Ω–æ—Å—Ç—å.


## 1. –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è –∏ —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∏

**BGP** = **B**order **G**ateway **P**rotocol (–ü—Ä–æ—Ç–æ–∫–æ–ª –ø–æ–≥—Ä–∞–Ω–∏—á–Ω–æ–≥–æ —à–ª—é–∑–∞)
**iBGP** = **I**nternal **B**order **G**ateway **P**rotocol (–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π BGP)
**eBGP** = **E**xternal **B**order **G**ateway **P**rotocol (–í–Ω–µ—à–Ω–∏–π BGP)

**AS** = **A**utonomous **S**ystem (–ê–≤—Ç–æ–Ω–æ–º–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞) - —Å–µ—Ç—å –ø–æ–¥ –µ–¥–∏–Ω—ã–º —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º

## 2. –§—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã iBGP

```mermaid
flowchart TD
    A[–û—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∞–≤–∏–ª–æ iBGP] --> B[–ú–∞—Ä—à—Ä—É—Ç, –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –æ—Ç<br>iBGP —Å–æ—Å–µ–¥–∞, –ù–ï –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è<br>–¥—Ä—É–≥–∏–º iBGP —Å–æ—Å–µ–¥—è–º]
    
    B --> C[–ü—Ä–∏—á–∏–Ω–∞: –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ<br>–ø–µ—Ç–µ–ª—å –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏<br>–≤–Ω—É—Ç—Ä–∏ AS]
    
    C --> D[–†–µ—à–µ–Ω–∏–µ 1: Full Mesh<br>–ö–∞–∂–¥—ã–π —Å –∫–∞–∂–¥—ã–º]
    C --> E[–†–µ—à–µ–Ω–∏–µ 2: Route Reflector<br>–û—Ç—Ä–∞–∂–∞—Ç–µ–ª—å –º–∞—Ä—à—Ä—É—Ç–æ–≤]
    C --> F[–†–µ—à–µ–Ω–∏–µ 3: Confederation<br>–ö–æ–Ω—Ñ–µ–¥–µ—Ä–∞—Ü–∏—è]
```

## 3. –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è iBGP —Å–µ—Å—Å–∏–∏

```mermaid
sequenceDiagram
    participant A as Router A
    participant B as Router B
    Note over A,B: –≠—Ç–∞–ø 1: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
    A->>A: router bgp 65001
    A->>A: neighbor 192.168.1.2 remote-as 65001
    B->>B: router bgp 65001
    B->>B: neighbor 192.168.1.1 remote-as 65001
    
    Note over A,B: –≠—Ç–∞–ø 2: TCP —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
    A->>B: TCP SYN (–ø–æ—Ä—Ç 179)
    B->>A: TCP SYN-ACK
    A->>B: TCP ACK
    Note over A,B: TCP —Å–µ—Å—Å–∏—è —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞
    
    Note over A,B: –≠—Ç–∞–ø 3: BGP OPEN —Å–æ–æ–±—â–µ–Ω–∏–µ
    A->>B: OPEN(Version=4, AS=65001, Hold Time=180, BGP ID=1.1.1.1)
    B->>A: OPEN(Version=4, AS=65001, Hold Time=180, BGP ID=2.2.2.2)
    
    Note over A,B: –≠—Ç–∞–ø 4: KEEPALIVE –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
    A->>B: KEEPALIVE
    B->>A: KEEPALIVE
    Note over A,B: –°–æ—Å—Ç–æ—è–Ω–∏–µ: Established
    
    Note over A,B: –≠—Ç–∞–ø 5: –û–±–º–µ–Ω –º–∞—Ä—à—Ä—É—Ç–∞–º–∏
    A->>B: UPDATE(NLRI=10.0.0.0/24, Path Attributes)
    B->>A: UPDATE(NLRI=10.0.1.0/24, Path Attributes)
```

## 4. –ö–ª—é—á–µ–≤—ã–µ –∞–±–±—Ä–µ–≤–∏–∞—Ç—É—Ä—ã –∏ –∏—Ö –∑–Ω–∞—á–µ–Ω–∏—è

### BGP —Å–æ–æ–±—â–µ–Ω–∏—è:
- **OPEN** - —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å–µ–¥—Å—Ç–≤–∞
- **UPDATE** - –æ–±—ä—è–≤–ª–µ–Ω–∏–µ/–æ—Ç–∑—ã–≤ –º–∞—Ä—à—Ä—É—Ç–æ–≤
- **KEEPALIVE** - –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏
- **NOTIFICATION** - –æ—à–∏–±–∫–∏ –∏ —Ä–∞–∑—Ä—ã–≤ —Å–µ—Å—Å–∏–∏

### –ê—Ç—Ä–∏–±—É—Ç—ã –ø—É—Ç–∏ (Path Attributes):
- **AS_PATH** = **AS** **PATH** (–ü—É—Ç—å –∞–≤—Ç–æ–Ω–æ–º–Ω—ã—Ö —Å–∏—Å—Ç–µ–º)
- **NEXT_HOP** = **NEXT** **HOP** (–°–ª–µ–¥—É—é—â–∏–π –ø—Ä—ã–∂–æ–∫)
- **LOCAL_PREF** = **LOCAL** **PREF**erence (–õ–æ–∫–∞–ª—å–Ω–æ–µ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ)
- **MED** = **M**ulti-**E**xit **D**iscriminator (–ú–Ω–æ–≥–æ–≤–∞—Ä–∏–∞–Ω—Ç–Ω—ã–π –¥–∏—Å–∫—Ä–∏–º–∏–Ω–∞—Ç–æ—Ä –≤—ã—Ö–æ–¥–∞)
- **ORIGIN** - –∏—Å—Ç–æ—á–Ω–∏–∫ –º–∞—Ä—à—Ä—É—Ç–∞
- **COMMUNITY** - —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤

## 5. –ü–æ–ª–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ BGP –º–∞—Ä—à—Ä—É—Ç–∞

```mermaid
flowchart TD
    A[BGP UPDATE Received] --> B[–ü–∞—Ä—Å–∏–Ω–≥ –∞—Ç—Ä–∏–±—É—Ç–æ–≤]
    
    B --> C[AS_PATH: AS65002 65003]
    C --> D[–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–µ—Ç–ª–∏]
    
    B --> E[NEXT_HOP: 192.168.1.1]
    E --> F[–î–æ—Å—Ç–∏–∂–∏–º–æ—Å—Ç—å —á–µ—Ä–µ–∑ IGP]
    
    B --> G[LOCAL_PREF: 100]
    G --> H[–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç –≤–Ω—É—Ç—Ä–∏ AS]
    
    B --> I[MED: 50]
    I --> J[–ü—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏–µ –ø—Ä–∏<br>–Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤—Ö–æ–¥–∞—Ö]
    
    K[BGP Decision Process] --> L[1. Highest Weight<br>Cisco Only]
    K --> M[2. Highest LOCAL_PREF]
    K --> N[3. Local Originated]
    K --> O[4. Shortest AS_PATH]
    K --> P[5. Lowest Origin Type]
    K --> Q[6. Lowest MED]
    K --> R[7. eBGP > iBGP]
    K --> S[8. Lowest IGP Metric]
    K --> T[9. Oldest Path]
    K --> U[10. Lowest Router ID]
    K --> V[11. Lowest Neighbor IP]
    
    W[Best Path Selected] --> X[Install in RIB]
    X --> Y[Advertise to Neighbors]
```

## 6. –†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É iBGP –∏ eBGP

```mermaid
flowchart LR
    subgraph iBGP_Features [iBGP —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏]
        A[–¢–æ—Ç –∂–µ AS –Ω–æ–º–µ—Ä]
        B[–ù–µ –∏–∑–º–µ–Ω—è–µ—Ç AS_PATH]
        C[–°–æ—Ö—Ä–∞–Ω—è–µ—Ç NEXT_HOP]
        D[Full Mesh —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–µ]
        E[–ò—Å–ø–æ–ª—å–∑—É–µ—Ç LOCAL_PREF]
    end
    
    subgraph eBGP_Features [eBGP —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏]
        F[–†–∞–∑–Ω—ã–µ AS –Ω–æ–º–µ—Ä–∞]
        G[–î–æ–±–∞–≤–ª—è–µ—Ç AS –≤ AS_PATH]
        H[–ú–µ–Ω—è–µ—Ç NEXT_HOP –Ω–∞ —Å–µ–±—è]
        I[–ù–µ—Ç Full Mesh —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è]
        J[–ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç LOCAL_PREF]
    end
    
    iBGP_Features --> K[–í–Ω—É—Ç—Ä–∏ AS]
    eBGP_Features --> L[–ú–µ–∂–¥—É AS]
```

## 7. –†–µ—à–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã Full Mesh: Route Reflector

**RR** = **R**oute **R**eflector (–û—Ç—Ä–∞–∂–∞—Ç–µ–ª—å –º–∞—Ä—à—Ä—É—Ç–æ–≤)

```mermaid
flowchart TD
    A[–ü—Ä–æ–±–ª–µ–º–∞ Full Mesh] --> B[N*(N-1)/2 —Å–µ—Å—Å–∏–π<br>–ü—Ä–∏–º–µ—Ä: 10 routers = 45 sessions]
    
    B --> C[–†–µ—à–µ–Ω–∏–µ: Route Reflector]
    
    C --> D[Architecture]
    D --> E[RR Client]
    D --> F[RR Client]
    D --> G[RR Client]
    D --> H[Non-Client]
    
    E --> I[–¢–æ–ª—å–∫–æ 1 —Å–µ—Å—Å–∏—è –∫ RR]
    F --> I
    G --> I
    H --> I
    
    I --> J[RR –æ—Ç—Ä–∞–∂–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç—ã:<br>–û—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ ‚Üí –≤—Å–µ–º<br>–û—Ç –Ω–µ-–∫–ª–∏–µ–Ω—Ç–æ–≤ ‚Üí —Ç–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç–∞–º]
```

## 8. –ê—Ç—Ä–∏–±—É—Ç—ã BGP —Å –ø–æ–¥—Ä–æ–±–Ω—ã–º –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ–º

### AS_PATH:
```
AS_PATH: 65002 65003 65004
```
- **–û–ø–∏—Å–∞–Ω–∏–µ:** –°–ø–∏—Å–æ–∫ AS, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ—à–µ–ª –º–∞—Ä—à—Ä—É—Ç
- **iBGP:** –ù–µ –¥–æ–±–∞–≤–ª—è–µ—Ç —Å–≤–æ–π AS
- **eBGP:** –î–æ–±–∞–≤–ª—è–µ—Ç —Å–≤–æ–π AS –≤ –Ω–∞—á–∞–ª–æ

### NEXT_HOP:
- **iBGP:** –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π NEXT_HOP –æ—Ç eBGP
- **–ü—Ä–æ–±–ª–µ–º–∞:** NEXT_HOP –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç–∏–∂–∏–º —á–µ—Ä–µ–∑ IGP
- **–†–µ—à–µ–Ω–∏–µ:** `next-hop-self` –∫–æ–º–∞–Ω–¥–∞

### LOCAL_PREF:
- **–î–∏–∞–ø–∞–∑–æ–Ω:** 0-4294967295
- **–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é:** 100
- **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:** –í—ã–±–æ—Ä –∏—Å—Ö–æ–¥—è—â–µ–≥–æ —Ç—Ä–∞—Ñ–∏–∫–∞ –∏–∑ AS

### MED:
- **–î–∏–∞–ø–∞–∑–æ–Ω:** 0-4294967295
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ:** –í–ª–∏—è–µ—Ç –Ω–∞ –≤—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫ –≤ AS
- **–ü—Ä–∞–≤–∏–ª–æ:** –ú–µ–Ω—å—à–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ

## 9. –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–∞ –≤ iBGP

```mermaid
flowchart TD
    A[Edge Router R1] --> B[–ü–æ–ª—É—á–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç 10.0.0.0/24 via eBGP]
    
    B --> C[–î–æ–±–∞–≤–ª—è–µ—Ç –≤ BGP Table]
    C --> D[–ü—Ä–∏–º–µ–Ω—è–µ—Ç LOCAL_PREF = 200]
    
    D --> E[–ê–¥–≤–µ—Ä—Ç–∞–π–∑ –≤ iBGP]
    E --> F[Full Mesh: –≤—Å–µ–º iBGP —Å–æ—Å–µ–¥—è–º]
    E --> G[Route Reflector: —Ç–æ–ª—å–∫–æ RR]
    
    F --> H[R2, R3, R4 –ø–æ–ª—É—á–∞—é—Ç –º–∞—Ä—à—Ä—É—Ç]
    G --> I[RR –ø–æ–ª—É—á–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç]
    
    I --> J[RR –æ—Ç—Ä–∞–∂–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç]
    J --> K[–í—Å–µ–º –∫–ª–∏–µ–Ω—Ç–∞–º RR]
    
    H --> L[BGP Decision Process]
    K --> L
    
    L --> M[–í—ã–±–æ—Ä –ª—É—á—à–µ–≥–æ –ø—É—Ç–∏]
    M --> N[–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ RIB]
    N --> O[–ò–Ω—Å—Ç–∞–ª–ª—è—Ü–∏—è –≤ forwarding table]
```

## 10. –í–∞–∂–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ —Å —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–æ–π

**RIB** = **R**outing **I**nformation **B**ase (–ë–∞–∑–∞ –º–∞—Ä—à—Ä—É—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏)
- **Loc-RIB** - –ª–æ–∫–∞–ª—å–Ω–∞—è BGP —Ç–∞–±–ª–∏—Ü–∞
- **Adj-RIB-In** - –ø–æ–ª—É—á–µ–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã –æ—Ç —Å–æ—Å–µ–¥–∞
- **Adj-RIB-Out** - –º–∞—Ä—à—Ä—É—Ç—ã –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ—Å–µ–¥—É

**NLRI** = **N**etwork **L**ayer **R**eachability **I**nformation (–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –¥–æ—Å—Ç–∏–∂–∏–º–æ—Å—Ç–∏ —Å–µ—Ç–µ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è)
- –ü—Ä–µ—Ñ–∏–∫—Å + –º–∞—Å–∫–∞ (10.0.0.0/24)

**IGP** = **I**nterior **G**ateway **P**rotocol (–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π —à–ª—é–∑–æ–≤–æ–π –ø—Ä–æ—Ç–æ–∫–æ–ª)
- OSPF, EIGRP, IS-IS - –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–≤—è–∑–Ω–æ—Å—Ç–∏

## 11. –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–∏–º–µ—Ä: –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è iBGP

```bash
! –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä R1 –≤ AS 65001
router bgp 65001
 ! BGP Router ID - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä
 bgp router-id 1.1.1.1
 bgp log-neighbor-changes
 
 ! iBGP —Å–æ—Å–µ–¥–∏ - —Ç–æ—Ç –∂–µ AS –Ω–æ–º–µ—Ä
 neighbor 192.168.1.2 remote-as 65001
 neighbor 192.168.1.3 remote-as 65001
 
 ! eBGP —Å–æ—Å–µ–¥ - –¥—Ä—É–≥–æ–π AS –Ω–æ–º–µ—Ä
 neighbor 10.1.1.2 remote-as 65002
 
 ! –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª–∞ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏
 no synchronization
 
 ! –ò–∑–º–µ–Ω–µ–Ω–∏–µ NEXT_HOP –Ω–∞ —Å–µ–±—è –¥–ª—è iBGP
 neighbor 192.168.1.2 next-hop-self
 neighbor 192.168.1.3 next-hop-self
 
 ! –û–±—ä—è–≤–ª–µ–Ω–∏–µ —Å–µ—Ç–µ–π
 network 192.168.1.0 mask 255.255.255.0
```

## 12. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ iBGP

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å BGP —Å–æ—Å–µ–¥–µ–π
show ip bgp neighbors

# –ü–æ–∫–∞–∑–∞—Ç—å BGP —Ç–∞–±–ª–∏—Ü—É
show ip bgp

# –ü–æ–∫–∞–∑–∞—Ç—å BGP summary
show ip bgp summary

# –û—Ç–ª–∞–¥–∫–∞ BGP —Å–æ–±—ã—Ç–∏–π
debug ip bgp events
debug ip bgp updates
```

## –ö–ª—é—á–µ–≤—ã–µ –≤—ã–≤–æ–¥—ã:

1. **iBGP —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–π AS**
2. **–¢—Ä–µ–±—É–µ—Ç Full Mesh –∏–ª–∏ Route Reflector**
3. **–ù–µ –∏–∑–º–µ–Ω—è–µ—Ç AS_PATH –¥–ª—è –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤**
4. **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç IGP –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è NEXT_HOP**
5. **LOCAL_PREF —É–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Å—Ö–æ–¥—è—â–∏–º —Ç—Ä–∞—Ñ–∏–∫–æ–º**
6. **MED –≤–ª–∏—è–µ—Ç –Ω–∞ –≤—Ö–æ–¥—è—â–∏–π —Ç—Ä–∞—Ñ–∏–∫**

iBGP –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–µ–π –º–∞—Ä—à—Ä—É—Ç–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤–Ω—É—Ç—Ä–∏ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã, —Ä–∞–±–æ—Ç–∞—è –≤ —Ç–µ—Å–Ω–æ–π –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å IGP –ø—Ä–æ—Ç–æ–∫–æ–ª–∞–º–∏.


## 1. –ü—Ä–æ–±–ª–µ–º–∞, –∫–æ—Ç–æ—Ä—É—é —Ä–µ—à–∞–µ—Ç Route Reflector

### Full Mesh –ø—Ä–æ–±–ª–µ–º–∞:
```mermaid
flowchart TD
    A[–ü—Ä–æ–±–ª–µ–º–∞ Full Mesh iBGP] --> B[N –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–æ–≤ = N*(N-1)/2 —Å–µ—Å—Å–∏–π]
    B --> C[–ü—Ä–∏–º–µ—Ä: 10 –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–æ–≤ = 45 —Å–µ—Å—Å–∏–π]
    C --> D[100 –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–æ–≤ = 4950 —Å–µ—Å—Å–∏–π!]
    D --> E[–°–ª–æ–∂–Ω–æ—Å—Ç—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è<br>–í—ã—Å–æ–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤]
```

## 2. –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è Route Reflector

**Route Reflector (RR)** = **–û—Ç—Ä–∞–∂–∞—Ç–µ–ª—å –º–∞—Ä—à—Ä—É—Ç–æ–≤** - —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π BGP –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç—Ä–∞–∂–∞–µ—Ç (—Ä–µ–ø–ª–∏—Ü–∏—Ä—É–µ—Ç) –º–∞—Ä—à—Ä—É—Ç—ã –º–µ–∂–¥—É —Å–≤–æ–∏–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏.

```mermaid
flowchart TD
    A[Route Reflector Architecture] --> B[–ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:]
    
    B --> C[Route Reflector - RR<br>–û—Ç—Ä–∞–∂–∞—Ç–µ–ª—å –º–∞—Ä—à—Ä—É—Ç–æ–≤]
    B --> D[RR Client - RRC<br>–ö–ª–∏–µ–Ω—Ç –æ—Ç—Ä–∞–∂–∞—Ç–µ–ª—è]
    B --> E[Non-Client - NC<br>–ù–µ-–∫–ª–∏–µ–Ω—Ç]
    
    C --> F[–û—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é<br>–º–∞—Ä—à—Ä—É—Ç–æ–≤ –º–µ–∂–¥—É –∫–ª–∏–µ–Ω—Ç–∞–º–∏]
    D --> G[–ò–º–µ–µ—Ç —Ç–æ–ª—å–∫–æ —Å–µ—Å—Å–∏—é —Å RR<br>–Ω–µ –∑–Ω–∞–µ—Ç –æ –¥—Ä—É–≥–∏—Ö –∫–ª–∏–µ–Ω—Ç–∞—Ö]
    E --> H[–û–±—ã—á–Ω—ã–π iBGP —Å–æ—Å–µ–¥ RR<br>—Å–æ–±–ª—é–¥–∞–µ—Ç –≤—Å–µ –ø—Ä–∞–≤–∏–ª–∞ iBGP]
```

## 3. –ü—Ä–∞–≤–∏–ª–∞ –æ—Ç—Ä–∞–∂–µ–Ω–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤

```mermaid
flowchart TD
    A[Route Reflector Rules] --> B[–û—Ç –∫–æ–≥–æ –ø–æ–ª—É—á–µ–Ω –º–∞—Ä—à—Ä—É—Ç?]
    
    B --> C[–û—Ç –ö–ª–∏–µ–Ω—Ç–∞]
    B --> D[–û—Ç –ù–µ-–ö–ª–∏–µ–Ω—Ç–∞]
    B --> E[–û—Ç eBGP —Å–æ—Å–µ–¥–∞]
    
    C --> F[–û—Ç—Ä–∞–∑–∏—Ç—å: –í—Å–µ–º –ö–ª–∏–µ–Ω—Ç–∞–º<br>–∏ –ù–µ-–ö–ª–∏–µ–Ω—Ç–∞–º]
    D --> G[–û—Ç—Ä–∞–∑–∏—Ç—å: –¢–æ–ª—å–∫–æ –ö–ª–∏–µ–Ω—Ç–∞–º]
    E --> H[–û—Ç—Ä–∞–∑–∏—Ç—å: –í—Å–µ–º –ö–ª–∏–µ–Ω—Ç–∞–º<br>–∏ –ù–µ-–ö–ª–∏–µ–Ω—Ç–∞–º]
```

## 4. –î–µ—Ç–∞–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ Route Reflector

```mermaid
flowchart TD
    A[Route Reflector RR] --> B[RR Client A]
    A --> C[RR Client B]
    A --> D[RR Client C]
    A --> E[Non-Client X]
    A --> F[eBGP Neighbor Y]
    
    style A fill:#e1f5fe
    style B fill:#c8e6c9
    style C fill:#c8e6c9
    style D fill:#c8e6c9
    style E fill:#ffecb3
    style F fill:#ffcdd2
    
    %% –ú–∞—Ä—à—Ä—É—Ç –æ—Ç Client A
    B -->|–ú–∞—Ä—à—Ä—É—Ç 10.1.0.0/24| A
    A -->|–û—Ç—Ä–∞–∑–∏—Ç—å –≤—Å–µ–º| C
    A -->|–û—Ç—Ä–∞–∑–∏—Ç—å –≤—Å–µ–º| D
    A -->|–û—Ç—Ä–∞–∑–∏—Ç—å –≤—Å–µ–º| E
    A -->|–û—Ç—Ä–∞–∑–∏—Ç—å –≤—Å–µ–º| F
    
    %% –ú–∞—Ä—à—Ä—É—Ç –æ—Ç Non-Client X
    E -->|–ú–∞—Ä—à—Ä—É—Ç 10.2.0.0/24| A
    A -->|–û—Ç—Ä–∞–∑–∏—Ç—å —Ç–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç–∞–º| B
    A -->|–û—Ç—Ä–∞–∑–∏—Ç—å —Ç–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç–∞–º| C
    A -->|–û—Ç—Ä–∞–∑–∏—Ç—å —Ç–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç–∞–º| D
    A -->|–ù–µ –æ—Ç—Ä–∞–∂–∞—Ç—å| E
    A -->|–ù–µ –æ—Ç—Ä–∞–∂–∞—Ç—å| F
    
    %% –ú–∞—Ä—à—Ä—É—Ç –æ—Ç eBGP
    F -->|–ú–∞—Ä—à—Ä—É—Ç 10.3.0.0/24| A
    A -->|–û—Ç—Ä–∞–∑–∏—Ç—å –≤—Å–µ–º| B
    A -->|–û—Ç—Ä–∞–∑–∏—Ç—å –≤—Å–µ–º| C
    A -->|–û—Ç—Ä–∞–∑–∏—Ç—å –≤—Å–µ–º| D
    A -->|–û—Ç—Ä–∞–∑–∏—Ç—å –≤—Å–µ–º| E
```

## 5. –ê—Ç—Ä–∏–±—É—Ç—ã Route Reflector

### –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–µ—Ç–µ–ª—å:
- **ORIGINATOR_ID** - Router ID –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ advertised –º–∞—Ä—à—Ä—É—Ç –≤ AS
- **CLUSTER_LIST** - —Å–ø–∏—Å–æ–∫ Cluster ID, —á–µ—Ä–µ–∑ –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ—à–µ–ª –º–∞—Ä—à—Ä—É—Ç

```mermaid
flowchart LR
    A[Client A] -->|–ú–∞—Ä—à—Ä—É—Ç 10.1.0.0/24| B[RR1]
    B --> C[–î–æ–±–∞–≤–ª—è–µ—Ç ORIGINATOR_ID = A<br>CLUSTER_LIST = 1.1.1.1]
    C --> D[Client B]
    D --> E[–ï—Å–ª–∏ –≤–∏–¥–∏—Ç —Å–≤–æ–π<br>ORIGINATOR_ID - –∏–≥–Ω–æ—Ä–∏—Ä—É–µ—Ç<br>–º–∞—Ä—à—Ä—É—Ç –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –ø–µ—Ç–µ–ª—å]
```

## 6. –ü—Ä–æ—Ü–µ—Å—Å –æ–±—Ä–∞–±–æ—Ç–∫–∏ –º–∞—Ä—à—Ä—É—Ç–∞ –≤ Route Reflector

```mermaid
flowchart TD
    A[RR –ø–æ–ª—É—á–∞–µ—Ç BGP UPDATE] --> B[–ê–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–∞]
    
    B --> C{–¢–∏–ø —Å–æ—Å–µ–¥–∞?}
    C --> D[RR Client]
    C --> E[Non-Client]
    C --> F[eBGP Neighbor]
    
    D --> G[–î–æ–±–∞–≤–∏—Ç—å ORIGINATOR_ID<br>–∏ CLUSTER_LIST –µ—Å–ª–∏ –Ω—É–∂–Ω–æ]
    E --> G
    F --> G
    
    G --> H[–ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞ –æ—Ç—Ä–∞–∂–µ–Ω–∏—è]
    
    H --> I[–û—Ç –ö–ª–∏–µ–Ω—Ç–∞:<br>–û—Ç—Ä–∞–∑–∏—Ç—å –í–°–ï–ú]
    H --> J[–û—Ç –ù–µ-–ö–ª–∏–µ–Ω—Ç–∞:<br>–û—Ç—Ä–∞–∑–∏—Ç—å —Ç–æ–ª—å–∫–æ –ö–õ–ò–ï–ù–¢–ê–ú]
    H --> K[–û—Ç eBGP:<br>–û—Ç—Ä–∞–∑–∏—Ç—å –í–°–ï–ú]
    
    I --> L[–û—Ç–ø—Ä–∞–≤–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç]
    J --> L
    K --> L
```

## 7. –ò–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ RR

### Multiple Route Reflectors:
```mermaid
flowchart TD
    A[Cluster 1] --> B[RR1]
    A --> C[Client A1]
    A --> D[Client A2]
    
    E[Cluster 2] --> F[RR2]
    E --> G[Client B1]
    E --> G[Client B2]
    
    H[Cluster 3] --> I[RR3]
    H --> J[Client C1]
    H --> K[Client C2]
    
    B <-->|iBGP Full Mesh| F
    F <-->|iBGP Full Mesh| I
    I <-->|iBGP Full Mesh| B
    
    style B fill:#e1f5fe
    style F fill:#e1f5fe
    style I fill:#e1f5fe
```

## 8. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Route Reflector

### –ù–∞ Route Reflector:
```bash
! –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Route Reflector
router bgp 65001
 bgp router-id 1.1.1.1
 !
 ! –û–±—ã—á–Ω—ã–µ iBGP —Å–æ—Å–µ–¥–∏ (Non-Clients)
 neighbor 192.168.1.100 remote-as 65001
 neighbor 192.168.1.100 route-reflector-client  # ‚ùå –ù–ï –ó–î–ï–°–¨!
 !
 ! RR Clients
 neighbor 192.168.2.1 remote-as 65001
 neighbor 192.168.2.1 route-reflector-client    # ‚úÖ –ö–õ–ò–ï–ù–¢
 
 neighbor 192.168.2.2 remote-as 65001
 neighbor 192.168.2.2 route-reflector-client    # ‚úÖ –ö–õ–ò–ï–ù–¢
 
 neighbor 192.168.2.3 remote-as 65001
 neighbor 192.168.2.3 route-reflector-client    # ‚úÖ –ö–õ–ò–ï–ù–¢
 
 ! eBGP —Å–æ—Å–µ–¥
 neighbor 10.1.1.2 remote-as 65002
```

### –ù–∞ RR Client (–æ–±—ã—á–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è):
```bash
! –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è RR Client
router bgp 65001
 bgp router-id 2.2.2.2
 !
 ! –¢–æ–ª—å–∫–æ —Å–µ—Å—Å–∏—è —Å Route Reflector
 neighbor 192.168.2.100 remote-as 65001
 !
 ! eBGP –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
 neighbor 10.2.1.2 remote-as 65003
```

## 9. –ü—Ä–∏–º–µ—Ä –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ —Ä–∞–±–æ—Ç—ã

```mermaid
sequenceDiagram
    participant A as Client A
    participant RR as Route Reflector
    participant B as Client B
    participant C as Non-Client
    participant D as eBGP Neighbor
    
    Note over A,RR: –ú–∞—Ä—à—Ä—É—Ç –æ—Ç Client A
    A->>RR: UPDATE: 10.1.0.0/24
    RR->>RR: –î–æ–±–∞–≤–∏—Ç—å ORIGINATOR_ID = A's RID
    RR->>B: UPDATE: 10.1.0.0/24 (ORIGINATOR_ID = A)
    RR->>C: UPDATE: 10.1.0.0/24 (ORIGINATOR_ID = A)
    RR->>D: UPDATE: 10.1.0.0/24 (ORIGINATOR_ID = A)
    
    Note over C,RR: –ú–∞—Ä—à—Ä—É—Ç –æ—Ç Non-Client C
    C->>RR: UPDATE: 10.2.0.0/24
    RR->>RR: –î–æ–±–∞–≤–∏—Ç—å ORIGINATOR_ID = C's RID
    RR->>A: UPDATE: 10.2.0.0/24 (ORIGINATOR_ID = C)
    RR->>B: UPDATE: 10.2.0.0/24 (ORIGINATOR_ID = C)
    Note over RR,D: Non-Client –º–∞—Ä—à—Ä—É—Ç –ù–ï –æ—Ç—Ä–∞–∂–∞–µ—Ç—Å—è eBGP
    
    Note over D,RR: –ú–∞—Ä—à—Ä—É—Ç –æ—Ç eBGP Neighbor
    D->>RR: UPDATE: 10.3.0.0/24 (AS_PATH: 65002)
    RR->>A: UPDATE: 10.3.0.0/24
    RR->>B: UPDATE: 10.3.0.0/24
    RR->>C: UPDATE: 10.3.0.0/24
```

## 10. –ö–ª–∞—Å—Ç–µ—Ä—ã Route Reflector

**Cluster** = –≥—Ä—É–ø–ø–∞ Route Reflector'–æ–≤ —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º **CLUSTER_ID**

```mermaid
flowchart TD
    A[Cluster 10] --> B[RR1]
    A --> C[RR2]
    A --> D[Clients]
    
    B --> E[–û–±–∞ RR –∏–º–µ—é—Ç<br>CLUSTER_ID = 10]
    C --> E
    
    F[–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞] --> G[–ò–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å]
    F --> H[–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –Ω–∞–≥—Ä—É–∑–∫–∏]
    F --> I[–ü—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ –ø–µ—Ç–µ–ª—å<br>—á–µ—Ä–µ–∑ CLUSTER_LIST]
```

## 11. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# –ü–æ–∫–∞–∑–∞—Ç—å BGP —Å–æ—Å–µ–¥–µ–π —Å –∏—Ö RR —Å—Ç–∞—Ç—É—Å–æ–º
show ip bgp neighbors

# –ü–æ–∫–∞–∑–∞—Ç—å BGP —Ç–∞–±–ª–∏—Ü—É —Å ORIGINATOR_ID
show ip bgp

# –î–µ—Ç–∞–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–∞—Ä—à—Ä—É—Ç–µ
show ip bgp 10.1.0.0/24

# –ü–æ–∫–∞–∑–∞—Ç—å RR –∫–ª–∏–µ–Ω—Ç–æ–≤
show ip bgp route-reflector clients
```

## 12. Best Practices

### –î–∏–∑–∞–π–Ω —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:
```mermaid
graph TB
    A[Best Practices] --> B[–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å 2+ RR<br>–¥–ª—è –∏–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç–∏]
    A --> C[–†–∞–∑–º–µ—â–∞—Ç—å RR –Ω–∞<br>P-–º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä–∞—Ö]
    A --> D[–ì—Ä—É–ø–ø–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤<br>–ø–æ –≥–µ–æ–≥—Ä–∞—Ñ–∏—á–µ—Å–∫–æ–º—É –ø—Ä–∏–Ω—Ü–∏–ø—É]
    A --> E[–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–∞–∑–Ω—ã–µ<br>CLUSTER_ID –≤ —Ä–∞–∑–Ω—ã—Ö –¥–∞—Ç–∞-—Ü–µ–Ω—Ç—Ä–∞—Ö]
    A --> F[–ú–æ–Ω–∏—Ç–æ—Ä–∏—Ç—å –Ω–∞–≥—Ä—É–∑–∫—É<br>–Ω–∞ RR]
```

## –ö–ª—é—á–µ–≤—ã–µ –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Route Reflector:

1. **‚úÖ –£–º–µ–Ω—å—à–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —Å–µ—Å—Å–∏–π** - —Å O(N¬≤) –¥–æ O(N)
2. **‚úÖ –£–ø—Ä–æ—â–µ–Ω–∏–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è** - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
3. **‚úÖ –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –±–æ–ª—å—à–∏—Ö —Å–µ—Ç–µ–π
4. **‚úÖ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å** - –ø—Ä–æ–∑—Ä–∞—á–µ–Ω –¥–ª—è –∫–ª–∏–µ–Ω—Ç–æ–≤
5. **‚úÖ –ò–∑–±—ã—Ç–æ—á–Ω–æ—Å—Ç—å** - —á–µ—Ä–µ–∑ Multiple RR

Route Reflector —Ä–µ—à–∞–µ—Ç —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞–ª—å–Ω—É—é –ø—Ä–æ–±–ª–µ–º—É –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç–∏ iBGP, –ø–æ–∑–≤–æ–ª—è—è —Å—Ç—Ä–æ–∏—Ç—å –∫—Ä—É–ø–Ω—ã–µ —Å–µ—Ç–∏ –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ–ª–Ω–æ–π —è—á–µ–∏—Å—Ç–æ–π —Ç–æ–ø–æ–ª–æ–≥–∏–∏.



## üè¢ –°—Ü–µ–Ω–∞—Ä–∏–π: –ö–æ–º–ø–∞–Ω–∏—è "–¢–µ—Ö–Ω–æ–ú–∏—Ä" —Å 4 —Ñ–∏–ª–∏–∞–ª–∞–º–∏

```mermaid
flowchart TD
    A[–ö–æ–º–ø–∞–Ω–∏—è –¢–µ—Ö–Ω–æ–ú–∏—Ä AS 65001] --> B[Route Reflector<br/>–ì–ª–∞–≤–Ω—ã–π –æ—Ñ–∏—Å –ú–æ—Å–∫–≤–∞]
    
    B --> C[–§–∏–ª–∏–∞–ª –°–ü–±<br/>–•–æ—á–µ—Ç –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç]
    B --> D[–§–∏–ª–∏–∞–ª –ï–ö–ë<br/>–•–æ—á–µ—Ç –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç]  
    B --> E[–§–∏–ª–∏–∞–ª –ù–°–ö<br/>–•–æ—á–µ—Ç –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç]
    B --> F[–§–∏–ª–∏–∞–ª –ö–†–î<br/>–•–æ—á–µ—Ç –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç]
    
    G[–ü—Ä–æ–≤–∞–π–¥–µ—Ä –ê AS 64500] --> B
    H[–ü—Ä–æ–≤–∞–π–¥–µ—Ä –ë AS 64501] --> B
```

## üîÑ –ü–æ–ª–Ω—ã–π —Ä–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å

### –®–∞–≥ 1: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
```bash
# –í—Å–µ —Ñ–∏–ª–∏–∞–ª—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç —Å–≤—è–∑—å –¢–û–õ–¨–ö–û —Å Route Reflector
–§–∏–ª–∏–∞–ª –°–ü–±   --> Route Reflector: "–ü—Ä–∏–≤–µ—Ç, —è —Ç–≤–æ–π –∫–ª–∏–µ–Ω—Ç"
–§–∏–ª–∏–∞–ª –ï–ö–ë   --> Route Reflector: "–ü—Ä–∏–≤–µ—Ç, —è —Ç–≤–æ–π –∫–ª–∏–µ–Ω—Ç"  
–§–∏–ª–∏–∞–ª –ù–°–ö   --> Route Reflector: "–ü—Ä–∏–≤–µ—Ç, —è —Ç–≤–æ–π –∫–ª–∏–µ–Ω—Ç"
–§–∏–ª–∏–∞–ª –ö–†–î   --> Route Reflector: "–ü—Ä–∏–≤–µ—Ç, —è —Ç–≤–æ–π –∫–ª–∏–µ–Ω—Ç"

# Route Reflector –æ—Ç–≤–µ—á–∞–µ—Ç
Route Reflector --> –í—Å–µ —Ñ–∏–ª–∏–∞–ª—ã: "–û–ö, –∑–∞–ø–æ–º–Ω–∏–ª –≤–∞—Å –∫–∞–∫ –∫–ª–∏–µ–Ω—Ç–æ–≤"
```

```
hostname    RR-MOSCOW

key chain BGP-KEYS
  key 1
     key-string NETWORK_NAME
     accept-lifetime 00:00:00 Jan 1 2025 infinite
     send-lifetime 00:00:00 Jan 1 2025 infinite
     cryptographic-algorithm HMAC-SHA-256



IP: 10.255.255.254
interface Loopback0
  ip address 10.255.255.254 2555.255.255.255

interface GigabitEthernet0/0
  ip address 203.0.113.2 255.255.255.255.252

interface GigabitEthernet0/1
  ip address 198.51.100.2 255.255.255.255.252

router bgp 65001
  bgp router-id 10.255.255.254
  neighbor RR-CLIENTS tcp-ao BGP-KEYCHAIN
  neighbor RR-CLIENTS peer-group
  neighbor RR-CLIENTS remote-as 65001
  neighbor RR-CLIENTS description iBGP-RR-CLINETS
  neighbor RR-CLIENTS route-reflector-client
  neighbor RR_CLIENTS next-hop-self all

  neighbor PROVIDERS peer-group
  neighbor PROVIDERS ebgp-multihop 2
  neighbor PROVIDERS update-source Loopback0

address-family ipv4
  network 10.0.0.0 mask 255.0.0.0

```

### –®–∞–≥ 2: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞—Ä—à—Ä—É—Ç–æ–≤
```mermaid
sequenceDiagram
    participant P1 as –ü—Ä–æ–≤–∞–π–¥–µ—Ä –ê
    participant P2 as –ü—Ä–æ–≤–∞–π–¥–µ—Ä –ë
    participant RR as Route Reflector
    participant C as –í—Å–µ —Ñ–∏–ª–∏–∞–ª—ã

    Note over P1,RR: Route Reflector –ø–æ–ª—É—á–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç—ã –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤

    P1->>RR: UPDATE: –ø—É—Ç—å –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç 0.0.0.0/0<br/>–ß–µ—Ä–µ–∑ –º–µ–Ω—è –±—ã—Å—Ç—Ä–µ–µ!
    P2->>RR: UPDATE: –ø—É—Ç—å –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç 0.0.0.0/0<br/>–ß–µ—Ä–µ–∑ –º–µ–Ω—è –Ω–∞–¥–µ–∂–Ω–µ–µ!

    Note over RR,RR: Route Reflector –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç:
    Note over RR,RR: - –ü—Ä–æ–≤–∞–π–¥–µ—Ä –ê: LOCAL_PREF = 200 (–ª—É—á—à–∏–π)
    Note over RR,RR: - –ü—Ä–æ–≤–∞–π–¥–µ—Ä –ë: LOCAL_PREF = 100 (—Ä–µ–∑–µ—Ä–≤–Ω—ã–π)

    RR->>C: –û–¢–†–ê–ñ–ê–ï–¢: –ò–¥–∏—Ç–µ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —á–µ—Ä–µ–∑ –ü—Ä–æ–≤–∞–π–¥–µ—Ä –ê!
    RR->>C: –û–¢–†–ê–ñ–ê–ï–¢: –†–µ–∑–µ—Ä–≤–Ω—ã–π –ø—É—Ç—å —á–µ—Ä–µ–∑ –ü—Ä–æ–≤–∞–π–¥–µ—Ä –ë
```

### –®–∞–≥ 3: –§–∏–ª–∏–∞–ª —Ö–æ—á–µ—Ç –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç
```mermaid
flowchart TD
    A[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤ –°–ü–±<br/>–∑–∞—Ö–æ–¥–∏—Ç –Ω–∞ google.com] --> B[–§–∏–ª–∏–∞–ª –°–ü–±]
    
    B --> C{–ö—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–∞–∫–µ—Ç?}
    C --> D[–°–º–æ—Ç—Ä—é –≤ —Ç–∞–±–ª–∏—Ü—É –º–∞—Ä—à—Ä—É—Ç–æ–≤]
    
    D --> E[–ù–∞—à–µ–ª –æ—Ç Route Reflector:<br/>0.0.0.0/0 —á–µ—Ä–µ–∑ –ü—Ä–æ–≤–∞–π–¥–µ—Ä –ê]
    E --> F[–û—Ç–ø—Ä–∞–≤–ª—è—é –ø–∞–∫–µ—Ç<br/>—á–µ—Ä–µ–∑ –ü—Ä–æ–≤–∞–π–¥–µ—Ä –ê]
    
    F --> G[–ü–∞–∫–µ—Ç –¥–æ—Ö–æ–¥–∏—Ç –¥–æ Google]
    G --> H[–û—Ç–≤–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è<br/>—á–µ—Ä–µ–∑ –ü—Ä–æ–≤–∞–π–¥–µ—Ä –ê]
```

### –®–∞–≥ 4: –û–±—â–µ–Ω–∏–µ –º–µ–∂–¥—É —Ñ–∏–ª–∏–∞–ª–∞–º–∏
```mermaid
sequenceDiagram
    participant SPB as –§–∏–ª–∏–∞–ª –°–ü–±
    participant RR as Route Reflector
    participant EKB as –§–∏–ª–∏–∞–ª –ï–ö–ë
    participant NSK as –§–∏–ª–∏–∞–ª –ù–°–ö

    Note over SPB,NSK: –§–∏–ª–∏–∞–ª –°–ü–± —Ö–æ—á–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –ï–ö–ë

    SPB->>RR: UPDATE: –ú–æ–∏ —Å–µ—Ç–∏ 10.1.0.0/16
    RR->>EKB: –û–¢–†–ê–ñ–ê–ï–¢: –°–µ—Ç–∏ –°–ü–± 10.1.0.0/16
    RR->>NSK: –û–¢–†–ê–ñ–ê–ï–¢: –°–µ—Ç–∏ –°–ü–± 10.1.0.0/16

    EKB->>RR: UPDATE: –ú–æ–∏ —Å–µ—Ç–∏ 10.2.0.0/16  
    RR->>SPB: –û–¢–†–ê–ñ–ê–ï–¢: –°–µ—Ç–∏ –ï–ö–ë 10.2.0.0/16
    RR->>NSK: –û–¢–†–ê–ñ–ê–ï–¢: –°–µ—Ç–∏ –ï–ö–ë 10.2.0.0/16

    Note over SPB,EKB: –¢–µ–ø–µ—Ä—å –°–ü–± –∑–Ω–∞–µ—Ç –∫–∞–∫<br/>–¥–æ—Å—Ç–∏—á—å –ï–ö–ë –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç
```

### –®–∞–≥ 5: –ü—Ä–æ–≤–∞–π–¥–µ—Ä –ê –ø–∞–¥–∞–µ—Ç - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ
```mermaid
flowchart TD
    A[‚ö° –ü—Ä–æ–≤–∞–π–¥–µ—Ä –ê –ø–µ—Ä–µ—Å—Ç–∞–ª —Ä–∞–±–æ—Ç–∞—Ç—å] --> B[Route Reflector –æ–±–Ω–∞—Ä—É–∂–∏–≤–∞–µ—Ç —Å–±–æ–π]
    
    B --> C[–£–¥–∞–ª—è–µ—Ç –º–∞—Ä—à—Ä—É—Ç —á–µ—Ä–µ–∑ –ü—Ä–æ–≤–∞–π–¥–µ—Ä –ê]
    C --> D[–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–±–∏—Ä–∞–µ—Ç –ü—Ä–æ–≤–∞–π–¥–µ—Ä –ë]
    
    D --> E[–û–¢–†–ê–ñ–ê–ï–¢ –í–°–ï–ú –§–ò–õ–ò–ê–õ–ê–ú:<br/>–¢–µ–ø–µ—Ä—å –∏–¥–∏—Ç–µ –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —á–µ—Ä–µ–∑ –ü—Ä–æ–≤–∞–π–¥–µ—Ä –ë!]
    
    E --> F[–§–∏–ª–∏–∞–ª –°–ü–± –ø–æ–ª—É—á–∞–µ—Ç UPDATE]
    E --> G[–§–∏–ª–∏–∞–ª –ï–ö–ë –ø–æ–ª—É—á–∞–µ—Ç UPDATE]
    E --> H[–§–∏–ª–∏–∞–ª –ù–°–ö –ø–æ–ª—É—á–∞–µ—Ç UPDATE]
    E --> I[–§–∏–ª–∏–∞–ª –ö–†–î –ø–æ–ª—É—á–∞–µ—Ç UPDATE]
    
    F --> J[–í—Å–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏<br/>–ø–µ—Ä–µ–∫–ª—é—á–∞—é—Ç—Å—è –Ω–∞ –ü—Ä–æ–≤–∞–π–¥–µ—Ä –ë]
    G --> J
    H --> J
    I --> J
    
    J --> K[–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –¥–∞–∂–µ –Ω–µ –∑–∞–º–µ—Ç–∏–ª–∏ —Å–±–æ—è!]
```

## üíª –†–µ–∞–ª—å–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ

### –ù–∞ Route Reflector:
```bash
# Route Reflector –ø–æ–ª—É—á–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç—ã –æ—Ç –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤
BGP: 203.0.113.1 (–ü—Ä–æ–≤–∞–π–¥–µ—Ä –ê) - –ø–æ–ª—É—á–µ–Ω –º–∞—Ä—à—Ä—É—Ç 0.0.0.0/0
BGP: 198.51.100.1 (–ü—Ä–æ–≤–∞–π–¥–µ—Ä –ë) - –ø–æ–ª—É—á–µ–Ω –º–∞—Ä—à—Ä—É—Ç 0.0.0.0/0

# Route Reflector –≤—ã–±–∏—Ä–∞–µ—Ç –ª—É—á—à–∏–π –ø—É—Ç—å
BGP: –õ—É—á—à–∏–π –ø—É—Ç—å –¥–æ 0.0.0.0/0 - —á–µ—Ä–µ–∑ 203.0.113.1

# Route Reflector –æ—Ç—Ä–∞–∂–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞–º
BGP: –û–¢–†–ê–ñ–ê–Æ 0.0.0.0/0 –∫–ª–∏–µ–Ω—Ç—É 10.1.1.1 (–°–ü–±)
BGP: –û–¢–†–ê–ñ–ê–Æ 0.0.0.0/0 –∫–ª–∏–µ–Ω—Ç—É 10.1.2.1 (–ï–ö–ë)
BGP: –û–¢–†–ê–ñ–ê–Æ 0.0.0.0/0 –∫–ª–∏–µ–Ω—Ç—É 10.1.3.1 (–ù–°–ö)
BGP: –û–¢–†–ê–ñ–ê–Æ 0.0.0.0/0 –∫–ª–∏–µ–Ω—Ç—É 10.1.4.1 (–ö–†–î)
```

### –ù–∞ —Ñ–∏–ª–∏–∞–ª–µ –°–ü–±:
```bash
# –ü–æ–ª—É—á–∞–µ—Ç –º–∞—Ä—à—Ä—É—Ç –æ—Ç Route Reflector
BGP: –ü–æ–ª—É—á–µ–Ω –º–∞—Ä—à—Ä—É—Ç 0.0.0.0/0 –æ—Ç 10.255.255.254 (RR)

# –î–æ–±–∞–≤–ª—è–µ—Ç –≤ —Ç–∞–±–ª–∏—Ü—É –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏–∏
ROUTING TABLE: 0.0.0.0/0 via 203.0.113.1

# –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–∞–π—Ç
USER: –ó–∞–ø—Ä–æ—Å –∫ 8.8.8.8 (Google DNS)
ROUTER: –û—Ç–ø—Ä–∞–≤–ª—è—é —á–µ—Ä–µ–∑ 203.0.113.1 (–ü—Ä–æ–≤–∞–π–¥–µ—Ä –ê)
```

## üïí –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞

```mermaid
gantt
    title –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ —Ä–∞–±–æ—Ç—ã Route Reflector
    dateFormat HH:mm:ss
    section –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    –ù–∞—Å—Ç—Ä–æ–π–∫–∞ BGP —Å–µ—Å—Å–∏–π :done, 00:00:00, 10s
    –û–±–º–µ–Ω –º–∞—Ä—à—Ä—É—Ç–∞–º–∏ :done, 00:00:10, 5s
    section –†–∞–±–æ—á–∏–π –ø—Ä–æ—Ü–µ—Å—Å
    –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–ø—Ä–æ—Å :active, 00:00:15, 2s
    –ú–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ü–∏—è :active, 00:00:16, 1s
    –ü–µ—Ä–µ–¥–∞—á–∞ –¥–∞–Ω–Ω—ã—Ö :active, 00:00:17, 3s
    section –°–±–æ–π –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ
    –ü—Ä–æ–≤–∞–π–¥–µ—Ä –ê –ø–∞–¥–∞–µ—Ç :crit, 00:01:00, 1s
    –û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Å–±–æ—è :crit, 00:01:01, 3s
    –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ :crit, 00:01:04, 2s
    –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ :crit, 00:01:06, 2s
```

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞–±–æ—Ç—ã

### –î–æ Route Reflector:
```
6 —É—Å—Ç—Ä–æ–π—Å—Ç–≤ = 15 BGP —Å–µ—Å—Å–∏–π
–ü—É—Ç–∞–Ω–∏—Ü–∞ –≤ –º–∞—Ä—à—Ä—É—Ç–∞—Ö
–ú–µ–¥–ª–µ–Ω–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
–°–ª–æ–∂–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
```

### –ü–æ—Å–ª–µ Route Reflector:
```
6 —É—Å—Ç—Ä–æ–π—Å—Ç–≤ = 5 BGP —Å–µ—Å—Å–∏–π
–ß–µ—Ç–∫–∏–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã  
–ë—ã—Å—Ç—Ä–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞ —Å–µ–∫—É–Ω–¥—ã
–ü—Ä–æ—Å—Ç–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –æ–¥–Ω—É —Ç–æ—á–∫—É
```

## üéØ –ò—Ç–æ–≥ —Ä–∞–±–æ—á–µ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞:

**Route Reflector —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ –¥–∏—Å–ø–µ—Ç—á–µ—Ä —Ç–∞–∫—Å–∏:**
1. **–ó–Ω–∞–µ—Ç** –≤—Å–µ—Ö –≤–æ–¥–∏—Ç–µ–ª–µ–π (–ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤)
2. **–ó–Ω–∞–µ—Ç** –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ (—Ñ–∏–ª–∏–∞–ª—ã)  
3. **–ù–∞–∑–Ω–∞—á–∞–µ—Ç** –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –º–∞—Ä—à—Ä—É—Ç –¥–ª—è –∫–∞–∂–¥–æ–π –ø–æ–µ–∑–¥–∫–∏
4. **–ü–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç** –∑–∞–∫–∞–∑—ã –ø—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö
5. **–í—Å–µ –¥–æ–≤–æ–ª—å–Ω—ã** - –∫–ª–∏–µ–Ω—Ç—ã –±—ã—Å—Ç—Ä–æ –µ–¥—É—Ç, –≤–æ–¥–∏—Ç–µ–ª–∏ –Ω–µ –ø—Ä–æ—Å—Ç–∞–∏–≤–∞—é—Ç

