
## Ответы для проверки

### Часть 1: Теоретические вопросы

**1. Архитектура FreeIPA**
- 389 Directory Server - хранение данных (пользователи, группы, политики)
- MIT Kerberos - безопасная аутентификация
- SSSD - клиентская служба интеграции
- Apache с модулями - веб-интерфейс и API
- Dogtag PKI - управление сертификатами
- BIND - DNS сервер

**2. Мандатные атрибуты**
- УЦ пользователя назначается в учетной записи
- УЦ ресурса определяется системой
- Доступ разрешен если УЦ пользователя >= УЦ ресурса
- Реализует модель Белла-ЛаПадулы

**3. Репликация**
- Data репликация (389 DS)
- CA репликация (Dogtag)
- DNS репликация (BIND)
- Процесс: `ipa-replica-install` на новом сервере

**4. Доверие с AD**
- Одностороннее доверие AD → FreeIPA
- Требования: NTP, DNS, сетевая доступность
- Команда: `ipa trust-add --type=ad`

**5. HBAC vs Sudo**
- HBAC: контроль доступа к хостам и сервисам
- Sudo: контроль привилегий на хостах
- Пример HBAC: разрешить группе ssh доступ к серверам
- Пример Sudo: разрешить группе выполнять systemctl

### Часть 2: Практические задания

**6. Команды:**
```bash
ipa user-add ivanov --first=Иван --last=Иванов
ipa group-add developers
ipa group-add-member developers --users=ivanov
ipa sudorule-add --hostcat=all --cmdcat=all developers_rule
ipa sudorule-add-user --groups=developers developers_rule
ipa user-show ivanov
```

**7. Настройка сервисов:**

Apache2:
- Установка mod_auth_kerb
- Создание service principal
- Настройка keytab
- Конфигурация VirtualHost

Samba:
- Присоединение к домену
- Настройка smb.conf с security=ads
- Использование idmap backend = sss
- Настройка общих ресурсов с valid users

**8. Диагностика:**
Логи:
- /var/log/sssd/sssd.log
- /var/log/secure
- /var/log/krb5kdc.log (на сервере)

Команды:
- `klist` (проверка билетов)
- `systemctl status sssd`
- `ipa ping` (проверка connectivity)
- `getent passwd user@domain`

Возможные причины:
- Проблемы с DNS
- Расхождение времени
- Блокировка учетной записи
- Проблемы с firewall

### Часть 3: Сценарии

**9. Архитектура:**
- Серверы: по 2 реплики в каждом офисе (всего 6)
- Топология: full mesh репликация
- DNS: разбиение на подзоны для каждого офиса
- Доверие с AD: через московский ЦОД
- Политики:
  - HBAC для разделения доступа к средам
  - Sudo правила по ролям
  - Отдельные политики паролей
